<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Number Guessing Game</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Join Screen -->
  <section id="join-screen" class="card">
    <h1 class="title">Number Guessing Game</h1>
    <div class="avatar">👤</div>

    <div class="form-group">
      <label>Tên người chơi</label>
      <input type="text" id="username" placeholder="">
    </div>

    <div class="form-group">
      <label>Mã phòng</label>
      <input type="text" id="room" placeholder="">
    </div>

    <div class="btn-group">
      <button id="createBtn" class="btn primary">Tạo phòng</button>
      <button id="joinBtn" class="btn success">Tham gia</button>
    </div>
  </section>

  <!-- Game Screen -->
  <section id="game-screen" class="hidden">
    <div class="container">
      <!-- Chat -->
      <aside class="card chat">
        <h2>💬 Chat</h2>
        <div class="chat-box" id="chatBox"></div>
        <div class="chat-input">
          <input type="text" id="chatMsg" placeholder="Nhập tin nhắn…">
          <button class="btn primary" id="sendChat">Gửi</button>
        </div>
      </aside>

      <!-- Game Area -->
      <main class="card game">
        <p class="hint">Hãy đoán số từ 1–100</p>
        <div class="guess-box">?</div>
        <!-- <div id="countdown" class="countdown">⏳ 10s</div> -->
        <div class="guess-input">
          <input type="number" id="guessInput" placeholder="Nhập số">
          <button class="btn success" id="guessBtn">Đoán</button>
        </div>
        <p id="result" class="result"></p>
      </main>

      <!-- Leaderboard -->
      <aside class="card leaderboard">
        <h2>🏆 Leaderboard</h2>
        <ul id="leaderboardList"></ul>
      </aside>
    </div>
  </section>

  <script>
    const joinBtn = document.getElementById("joinBtn");
    const createBtn = document.getElementById("createBtn");
    const joinScreen = document.getElementById("join-screen");
    const gameScreen = document.getElementById("game-screen");

    let socket;
    let username;

    function switchScreen() {
      username = document.getElementById("username").value.trim() || "Khách";
      const room = document.getElementById("room").value.trim();

      // Ẩn màn hình join, hiện gameplay
      joinScreen.classList.add("hidden");
      gameScreen.classList.remove("hidden");

      // Kết nối WebSocket
      socket = new WebSocket("ws://localhost:8000/ws");

      socket.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.type === "chat") {
          const chatBox = document.getElementById("chatBox");
          const p = document.createElement("p");
          p.innerHTML = `<b>${data.username}:</b> ${data.message}`;
          chatBox.appendChild(p);
          chatBox.scrollTop = chatBox.scrollHeight;
        }

        if (data.type === "leaderboard") {
          const list = document.getElementById("leaderboardList");
          list.innerHTML = "";
          data.scores.forEach(player => {
            const li = document.createElement("li");
            li.innerHTML = `<span>${player.name}</span><span>${player.points} pts</span>`;
            list.appendChild(li);
          });
        }

        if (data.type === "result") {
          document.getElementById("result").innerText = data.message;
        }
      };
    }

    joinBtn.addEventListener("click", switchScreen);
    createBtn.addEventListener("click", switchScreen);

    // Gửi chat
    document.getElementById("sendChat").addEventListener("click", () => {
      const msg = document.getElementById("chatMsg").value;
      if (msg.trim() !== "") {
        socket.send(JSON.stringify({ type: "chat", username: username, message: msg }));
        document.getElementById("chatMsg").value = "";
      }
    });

    // Gửi đoán số
    document.getElementById("guessBtn").addEventListener("click", () => {
      const guess = parseInt(document.getElementById("guessInput").value);
      if (!isNaN(guess)) {
        socket.send(JSON.stringify({ type: "guess", username: username, number: guess }));
      }
    });
  </script>
</body>
</html>
